{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "description": "A basic pie chart example.",
  "width": 900,
  "height": 600,
  "autosize": "pad",

"signals": [
    {"name": "mapHeight", "value": 400},
    {"name": "mapWidth", "value": 400},
    {"name": "timeHeight", "value": 100},
    {"name": "shapeHeight", "value": 400},
    {"name": "howto"}
  ],
"scales": [
    {
  "name": "layouty",
  "type": "band",
  "domain": ["one", "two", "three"],
  "range": "height"
},
{
  "name": "layoutx",
  "type": "band",
  "domain": ["one, two"],
  "range": "width"
}
  ],

"projections": [
  {
    "name": "projection",
    "type": "mercator",
    "size":{"signal": "[mapWidth,mapHeight]"},
    "fit": {"signal": "data('europe')"},
    "clipExtent": [[0, 0], [400, 400]]
  }
],

"data": [
    {"name": "ufo-sightings",
    "url": "https://raw.githubusercontent.com/Alquila/Datavis2022Group1/main/data/smallDataset.csv",
    "format": {"type": "csv", "parse": "auto", "delimiter": ","},
    "transform": [
      {"type": "geopoint","projection": "projection",
        "fields": ["longitude", "latitude"]       },
      {"type": "filter","expr": "datum.x != null && datum.y != null"}
     ]
    },

    {"name": "spots", "source" : ["ufo-sightings"],
    "transform": [
      {"type": "aggregate","groupby": ["country"],"as": ["counts"]}
    ]
    },
    {"name": "europe",
      "url": "https://raw.githubusercontent.com/Alquila/Datavis2022Group1/main/data/europe.json",
       "format": {"type": "topojson","feature": "continent_Europe_subunits"}
    },
    {"name": "eu",  "source": ["europe"],
      "transform": [{"type": "lookup","from": "spots",
              "key": "country", "values": ["counts"],
              "fields": ["properties['geounit']"],"default": 0}]
    },
    {"name": "north-america",
          "url": "https://raw.githubusercontent.com/Alquila/Datavis2022Group1/main/data/north-america.json",
          "format": {"type": "topojson",  
          "feature":"continent_North_America_subunits"},
          "transform": [
            {
              "type": "lookup",
              "from": "spots",
              "key": "country",
              "values": ["counts"],
              "fields": ["properties['geounit']"],
              "default": 0

            }
          ]
    },
    {"name": "europa-sig",
    "source": ["ufo-sightings"],
    "transform": [
      {
        "type": "geopoint",
        "projection": "projection",
        "fields": ["longitude", "latitude"]
      },
      {
          "type": "filter", "expr": "howto ? datum.date > howto[0] && datum.date <= howto[1] : datum "
        } 
    ]
    },
    {"name": "graticule","transform": [{ "type": "graticule", "step": [10, 10]}]},
    {
      "name": "eu-shapes",
      "source": ["europa-sig"],
      "transform": [
        {"type": "aggregate", "groupby": ["shape"], "as":["shapes"]}
      ]
    },
    {
        "name": "tree",
        "url": "https://raw.githubusercontent.com/Alquila/Datavis2022Group1/main/data/shapeTree.json",
        "transform": [
          {
            "type": "lookup",
            "from": "eu-shapes",
            "key": "shape",
            "values": ["shapes"],
            "fields":["name"]
          },
          {
            "type": "stratify",
            "key": "id",
            "parentKey": "parent"
          },
          {
            "type": "partition",
            "field": "shapes",
            "sort": {"field": "value"},
            "size": [{"signal": "2 * PI"}, {"signal": "shapeHeight / 3"}],
            "as": ["a0", "r0", "a1", "r1", "depth", "children"]
          }
        ]
      }
  ],


"layout": {
    "padding": 20,
    "columns": 2,
    "align": "each",
    "bounds":"flush",
    "center":false
  },  

  "marks": [
    {"name": "usagroup",
      "type": "group",
      "description": "Map of stuff",
      "clip":true,
      "encode": {
        "enter":{
          "width":{"signal": "mapWidth"},
          "height": {"signal": "mapHeight"},
          "fill": {"value": "#fadcfc"}
        }
      },

    "projections": [
    {
      "name": "projection",
      "type": "conicEquidistant",
      "size":{"signal": "[mapWidth,mapHeight]"},
      "fit": {"signal": "data('north-america')"},
      "clipExtent": [[0, 0], [400, 400]],
      "rotate":[80,0,0]
    }],

    "data": [
      {
    "name": "usa-sig",
    "source": ["ufo-sightings"],
    "transform": [
      {
        "type": "geopoint",
        "projection": "projection",
        "fields": ["longitude", "latitude"]
      },
      {
          "type": "filter", "expr": "howto ? datum.date > howto[0] && datum.date <= howto[1] : datum "
        } 
    ]
    }
    ],

    "marks": [
    {
      "type": "shape",
      "from": {"data": "graticule"},
      "transform": [{ "type": "geoshape", "projection": "projection" }]},
    {
      "type": "shape",
      "from": {"data": "north-america"},
      "encode": {
        "enter":{
          "strokeWidth": {"value": 0.25},
          "stroke": {"value": "#888"}, "fill": {"value": "pink"},
          "tooltip": {"signal": "{'Country': datum.properties['geounit'], 'Count' : datum.counts}"}
        },
      "update": {
        "strokeWidth": {"value": 0.5},
        "stroke": {"value": "black"},
        "fill": {"value": "grey"}
      },
      "hover": {"fill": {"value": "pink"}}
     
      },
      "transform": [
        { "type": "geoshape", "projection": "projection" }
      ]
    },
    {
      "type": "symbol",
      "from": {"data": "usa-sig"},
      "clip": true,
      "encode": {
        "enter": {
          "size": {"value": 16},
          "fill": {"value": "steelblue"},
          "fillOpacity": {"value": 0.8},
          "stroke": {"value": "white"},
          "strokeWidth": {"value": 1.5},
          "tooltip": {
            "signal": "{'title': datum.city, 'Shape': datum.shape}"
          }
        },
        "update": {
          "x": {"field": "x"},
          "y": {"field": "y"}
        }
      }
    }
    ]

    },
    {"name": "eu-group",
      "type": "group",
      "clip":true, 
      "foreground": true,
      "encode": {
        "enter":{
          "width":{"signal": "mapWidth"},
          "height": {"signal": "mapHeight"},
          "fill": {"value": "#fadc11"}
        }
      },

      "projections": [
    {
      "name": "projection",
      "type": "conicEquidistant",
      "size":{"signal": "[mapWidth,mapHeight]"},
      "fit": {"signal": "data('europe')"},
      "clipExtent": [[0, 0], [400, 400]],
      "rotate":[50,30,0]
    }],

    "marks": [
        {
    "type": "shape",
    "from": {"data": "graticule"},
    "transform": [
      { "type": "geoshape", "projection": "projection" }
    ]
  },
  {
    "type": "shape",
    "from": {"data": "eu"},
    "encode": {
      "enter":{
        "strokeWidth": {"value": 0.25},
          "stroke": {"value": "#888"},
          "fill": {"value": "pink"},
          "tooltip": {
        "signal": "{'Country': datum.properties['geounit'], 'Count': datum.counts}"
      }
      },
      "update": {
        "strokeWidth": {"value": 0.5},
        "stroke": {"value": "black"},
        "fill": {"value": "grey"}
      },
      "hover": {"fill": {"value": "pink"}}
     
    },
    "transform": [
      { "type": "geoshape", "projection": "projection" }
    ]
  },
{
  "type": "symbol",
  "from": {"data": "europa-sig"},
  "clip": true,
  "encode": {
    "enter": {
      "size": {"value": 16},
      "fill": {"value": "steelblue"},
      "fillOpacity": {"value": 0.8},
      "stroke": {"value": "white"},
      "strokeWidth": {"value": 1.5},
      "tooltip": {
        "signal": "{'title': datum.city, 'Shape': datum.shape}"
      }
    },
    "update": {
      "x": {"field": "x"},
      "y": {"field": "y"}
    }
  }
}
      ]

    },
    {"name": "timeline1",
      "type": "group",
      "encode": {
        "enter":{
          "width":{"signal": "mapWidth"},
          "height": {"signal": "timeHeight"}
        }
      },
      "marks": [
        {
          "type": "group",
          "name": "timee",
          "encode": {
          "enter":{
            "width":{"signal": "mapWidth*2"},
            "height": {"signal": "timeHeight"},
            "fill": {"value": "lightgrey"},
            "opacity": {"value": 0.5},
            "x":{"offset":10}
          }
          },
          "data": [
            {
              "name": "timedata",
              "source": ["ufo-sightings"],
              "transform": [
                {"type": "filter", "expr": "datum.date >= -638326800000"},
        {
          "field": "date",
          "type": "timeunit",
          "units": ["year"],
          "as": ["year_date", "year_date_end"]
        },
        {
          "type": "aggregate",
          "groupby": ["year_date"],
          "ops": ["count"],
          "fields": [null],
          "as": ["__count"]
        }
      ]
            }
          ],

          "signals": [
            {
          "name": "brush", "value": 0,
          "on": [
            {
              "events": "@timee:mousedown",
              "update": "[x(), x()]"
            },
            {
              "events": "[@timee:mousedown, window:mouseup] > window:mousemove!",
              "update": "[brush[0], clamp(x(), 0, width)]"
            },
            {
              "events": {"signal": "delta"},
              "update": "clampRange([anchor[0] + delta, anchor[1] + delta], 0, width)"
            }
          ]
        },
        {
          "name": "anchor", "value": null,
          "on": [{"events": "@brush:mousedown", "update": "slice(brush)"}]
        },
        {
          "name": "xdown", "value": 0,
          "on": [{"events": "@brush:mousedown", "update": "x()"}]
        },
        {
          "name": "delta", "value": 0,
          "on": [
            {
              "events": "[@brush:mousedown, window:mouseup] > window:mousemove!",
              "update": "x() - xdown"
            }
          ]
        },
        {
          "name": "howto",
          "push": "outer",
          "on": [
            {
              "events": {"signal": "brush"},
              "update": "span(brush) ? invert('x', brush) : null"
            }
          ]
        }
          ],


          "scales": [
    {
      "name": "x",
      "type": "time",
      "domain": {"data": "timedata", "field": "year_date"},
      "range": [0, {"signal": "mapWidth*2"}]
    },
    {
      "name": "y",
      "type": "linear",
      "domain": {"data": "timedata", "field": "__count"},
      "range": [{"signal": "timeHeight"}, 0],
      "nice": true,
      "zero": true
    }
          ],


         "axes": [
    {
      "scale": "x",
      "orient": "bottom",
      "gridScale": "y",
      "grid": true,
      "tickCount": {"signal": "ceil(width/40)"},
      "domain": false,
      "labels": false,
      "aria": false,
      "maxExtent": 0,
      "minExtent": 0,
      "ticks": false,
      "zindex": 0
    },
    {
      "scale": "y",
      "orient": "left",
      "gridScale": "x",
      "grid": true,
      "tickCount": {"signal": "ceil(height/50)"},
      "domain": false,
      "labels": false,
      "aria": false,
      "maxExtent": 0,
      "minExtent": 0,
      "ticks": false,
      "zindex": 0
    },
    {
      "scale": "x",
      "orient": "bottom",
      "grid": false,
      "title": "date (year)",
      "format": "%Y",
      "labelFlush": true,
      "labelOverlap": true,
      "tickCount": {"signal": "ceil(width/40)"},
      "zindex": 0
    },
    {
      "scale": "y",
      "orient": "left",
      "grid": false,
      "title": "count",
      "labelOverlap": true,
      "tickCount": {"signal": "ceil(height/50)"},
      "zindex": 0
    }
          ],

          "marks": [
          {
      "name": "marks",
      "type": "line",
      "style": ["line"],
      "sort": {"field": "datum[\"year_date\"]"},
      "from": {"data": "timedata"},
      "encode": {
        "update": {
          "stroke": {"value": "#4c78a8"},
          "tooltip": {
            "signal": "\"date (year): \" + (timeFormat(datum[\"year_date\"], '%Y')) + \"; count: \" + (format(datum[\"__count\"], \"\"))"
          },
          "x": {"scale": "x", "field": "year_date"},
          "y": {"scale": "y", "field": "__count"}
        }
      }
          },
          {
      "name": "dots",
      "type": "symbol",
      "sort": {"field": "datum[\"year_date\"]"},
      "from": {"data": "timedata"},
      "encode": {
        "update": {
          "size": {"value": 20},
      "fill": {"value": "steelblue"},
      "fillOpacity": {"value": 0.5},
      "stroke": {"value": "black"},
      "strokeWidth": {"value": 1.5},
          "tooltip": {
            "signal": "\" \" + (timeFormat(datum[\"year_date\"], '%Y')) + \"; sightings: \" + (format(datum[\"__count\"], \"\"))"
          },
          "x": {"scale": "x", "field": "year_date"},
          "y": {"scale": "y", "field": "__count"},
          "defined": {
            "signal": "isValid(datum[\"year_date\"]) && isFinite(+datum[\"year_date\"]) && isValid(datum[\"__count\"]) && isFinite(+datum[\"__count\"])"
          }
        }
      }
          },
          {
            "name": "brush",
            "type": "rect",
            "encode": {
              "enter":{
                "y": {"value": 0},"height": {"signal": "timeHeight"},
              "fill": {"value": "green"},"fillOpacity": {"value": 0.2}
              },
              "update": {
                "x": {"signal": "brush[0]"},
                "x2": {"signal": "brush[1]"}
              }
            }
          },
          {
          "type": "rect",
          "interactive": false,
          "encode": {
            "enter": {
              "y": {"value": 0},
              "height": {"signal": "timeHeight"},
              "width": {"value": 1},
              "fill": {"value": "yellow"}
            },
            "update": {
              "x": {"signal": "brush[0]"}
            }
          }
        },
        {
          "type": "rect",
          "interactive": false,
          "encode": {
            "enter": {
              "y": {"value": 0},
              "height": {"signal": "timeHeight"},
              "width": {"value": 1},
              "fill": {"value": "firebrick"}
            },
            "update": {
              "x": {"signal": "brush[1]"}
            }
          }
        }
          ]
        }
      ]
    },
    {"name": "placeholder",
      "type": "group",
      "description": "placeholder to make space for timeline",
      "encode": {
        "enter":{
          "width":{"signal": "mapWidth/2"},
          "height": {"signal": "timeHeight"}
        }
      }
    },
    {"name": "shape-charts",
      "type": "group",
      "encode": {
        "enter":{
          "width":{"signal": "mapWidth"},
          "height": {"signal": "shapeHeight"},
          "fill": {"value": "green"},
          "opacity":{"value": 0.5}
        }
      },

      "layout":{
        "padding": 20,
        "columns": 2,
        "align": "each",
    "bounds":"flush",
    "center":false
      },

      "marks": [
        {"name": "us-shape-chart",
          "type": "group",
          "encode": {
            "enter":{
              "width":{"signal": "mapWidth"},
              "height": {"signal": "shapeHeight-100"},
              "fill": {"value": "lightgreen"},
          "opacity":{"value": 0.5}
            }
          },
          "scales": [
      {
        "name": "color",
        "type": "ordinal",
        "domain": {"data": "tree", "field": "depth"},
        "range": {"scheme": "tableau20"}
      }
    ],

    "title":{
      "text": "Sunburstchart over shapes in North America",
      "anchor":"start",
      "orient":"bottom"
    },

    "marks": [
      {
        "type": "arc",
        "from": {"data": "tree"},
        "encode": {
          "enter": {
            "x": {"signal": "mapWidth / 2"},
            "y": {"signal": "(shapeHeight-100)/ 2"},
            "fill": {"scale": "color", "field": "depth"}
          },
          "update": {
            "startAngle": {"field": "a0"},
            "endAngle": {"field": "a1"},
            "innerRadius": {"field": "r0"},
            "outerRadius": {"field": "r1"},
            "stroke": {"value": "white"},
            "strokeWidth": {"value": 1},
            "zindex": {"value": 0},
            "tooltip": {"signal": "datum.name + (datum.shapes ? ', ' + datum.shapes + ' sightings' : '')"}
          },
          "hover": {
            "stroke": {"value": "red"},
            "strokeWidth": {"value": 2},
            "zindex": {"value": 1}
            }
            }
          }
        ]
        },
        {"name": "eu-shape-chart",
          "type": "group",
          "encode": {
            "enter":{
              "width":{"signal": "mapWidth"},
          "height": {"signal": "shapeHeight-100"},
          "fill": {"value": "darkgreen"},
          "opacity":{"value": 0.5}
            }
          },

 "title":{
      "text": "Sunburstchart over shapes in Europe",
      "anchor":"start",
      "orient":"bottom"
    },
          
          "scales": [
      {
        "name": "color",
        "type": "ordinal",
        "domain": {"data": "tree", "field": "depth"},
        "range": {"scheme": "tableau20"}
      }
    ],
  
    "marks": [
      {
        "type": "arc",
        "from": {"data": "tree"},
        "encode": {
          "enter": {
            "x": {"signal": "mapWidth / 2"},
            "y": {"signal": "(shapeHeight-100)/ 2"},
            "fill": {"scale": "color", "field": "depth"}
          },
          "update": {
            "startAngle": {"field": "a0"},
            "endAngle": {"field": "a1"},
            "innerRadius": {"field": "r0"},
            "outerRadius": {"field": "r1"},
            "stroke": {"value": "white"},
            "strokeWidth": {"value": 1},
            "zindex": {"value": 0},
            "tooltip": {"signal": "datum.name + (datum.shapes ? ', ' + datum.shapes + ' sightings' : '')"}
          },
          "hover": {
            "stroke": {"value": "red"},
            "strokeWidth": {"value": 2},
            "zindex": {"value": 1}
          }
        }
      }
    ]
        }
      ]
    }
  ],

"title":{
  "text": "Visualization of UFO sightings in North America and Europe",
"anchor": "start",
"font": "arial",
"fontSize": 20,
"fontStyle": "normal",
"encode":{"title":{"enter": {"fill": {"value": "purple"}}}}
}


}
